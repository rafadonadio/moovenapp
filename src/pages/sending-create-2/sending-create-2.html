<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons start>
            <button ion-button (click)="goBack()">
                <ion-icon name="arrow-back"></ion-icon>
            </button>
        </ion-buttons>
        <ion-title>Nuevo</ion-title>
    </ion-toolbar>
</ion-header>
<ion-content>
    <form [formGroup]="formTwo"> 
        <ion-list>
            <ion-item-divider>Datos del Retiro
                <ion-note item-right>
                    <ion-icon name="radio-button-on"></ion-icon>
                    <ion-icon name="radio-button-on"></ion-icon>
                    <ion-icon name="radio-button-off"></ion-icon>
                    <ion-icon name="radio-button-off"></ion-icon>
                </ion-note>
            </ion-item-divider>             
            <div class="map-container">
                <div id="mapf2"></div>
            </div>
            <ion-list-header>Dirección de Retiro</ion-list-header>
            <ion-item>
                <ion-input type="text" placeholder="Ingresa la dirección" 
                    formControlName="pickupAddressFullText"
                    (click)="showAddressSearchModal()"
                    readonly></ion-input>
            </ion-item> 
            <ion-item *ngIf="sending.pickupAddressSet==true">
                <ion-label color="warn" stacked>Info adicional de la dirección</ion-label>
                <ion-input type="text" clearInput 
                    placeholder="nro de piso, depto, oficina, etc" 
                    formControlName="pickupAddressLine2"
                    ></ion-input>
            </ion-item> 
            <ion-item *ngIf="sending.pickupAddressSet==true">
                <ion-icon name="pin" item-left></ion-icon>
                <h2>{{ sending.pickupAddressStreetShort }} {{ sending.pickupAddressNumber }}</h2>
                <h3>{{ sending.pickupAddressCityShort }}</h3>
                <p>{{ sending.pickupAddressStateLong }}</p>
                <button ion-button item-right clear color="sublight"
                    (click)="resetAddress()">
                    <ion-icon name="close-circle"></ion-icon>
                </button>                
            </ion-item>              
            <div *ngIf="showErrors && !pickupAddressFullText.valid" 
                class="input-error">* Dirección de retiro es requerida</div>
            <ion-list-header margin-top>Banda horaria de Retiro</ion-list-header>
            <ion-item>
                <ion-label>Desde</ion-label>
                <ion-datetime 
                    formControlName="pickupTimeFrom" 
                    displayFormat="HH:mm" 
                    hourValues="00,01,02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21,22"
                    minuteValues="00,30"
                    cancelText="Cancelar" doneText="Listo" 
                    [(ngModel)]="rangeFrom" 
                    (ionChange)="adjustPickupTimeTo($event)"></ion-datetime>
            </ion-item>
            <ion-item>
                <ion-label>Hasta</ion-label>
                <ion-datetime 
                formControlName="pickupTimeTo" 
                displayFormat="HH:mm" 
                hourValues="02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21,22,23,00"
                minuteValues="00,30" 
                cancelText="Cancelar" doneText="Listo" 
                [(ngModel)]="rangeTo" 
                (ionChange)="adjustPickupTimeFrom($event)"></ion-datetime>
            </ion-item>
            <div *ngIf="showErrors && !pickupTimeFrom.touched && !pickupTimeTo.touched" 
                class="input-optional"><small>* verifica que el horario de retiro sea correcto</small></div>
            <ion-list-header>
                Contacto para Retiro
                <button ion-button outline item-right small 
                    (click)="populateContactWithUserData()">Pegar mis datos</button>
            </ion-list-header>
            <ion-list inset>
                <ion-item no-lines>
                    <ion-label>Nombre</ion-label>
                    <ion-input type="text" clearInput 
                        formControlName="pickupPersonName"></ion-input>
                </ion-item>
                <div *ngIf="pickupPersonName.hasError('required') && pickupPersonName.touched || showErrors && pickupPersonName.valid==false" 
                    class="input-error">* ingresa un nombre de contacto</div>
                <ion-item no-lines>
                    <ion-label>Telefono</ion-label>
                    <ion-input type="text" clearInput formControlName="pickupPersonPhone"></ion-input>
                </ion-item>
                <div *ngIf="pickupPersonPhone.hasError('required') && pickupPersonPhone.touched || showErrors && pickupPersonPhone.valid==false" 
                    class="input-error">* ingresa un teléfono de contacto</div>                
                <ion-item no-lines>
                    <ion-label>Email</ion-label>
                    <ion-input type="text" clearInput formControlName="pickupPersonEmail"></ion-input>
                </ion-item>
                <div *ngIf="showErrors && pickupPersonEmail.value==''" 
                    class="input-optional">* ingresa un email de contacto (opcional)</div> 
                <div *ngIf="pickupPersonEmail.value!='' && pickupPersonEmail.hasError('isValid') && pickupPersonEmail.touched" 
                    class="input-error">* ingresa una dirección válida</div>                
            </ion-list>
        </ion-list>
        <div margin>
            <button ion-button block color="primary" 
                (click)="submit()">Siguiente</button>
            <button ion-button block color="primary" outline margin-top 
                (click)="goBack()">Volver</button>                
            <button ion-button block color="subdark" clear margin-top 
                (click)="cancel()">Cancelar</button>
        </div>
    </form>
</ion-content>